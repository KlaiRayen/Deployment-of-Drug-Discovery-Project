<!DOCTYPE html>
<html data-wf-domain="www.prosion.eu" data-wf-page="6357cbd929cfb5fea5d808a6" data-wf-site="6356ba441271195b07290d97" lang="en">
{% load static %}
<head>
    <meta charset="utf-8" />
    <title>Generation of Drug Ligands</title>
    <link href="https://assets-global.website-files.com/6356ba441271195b07290d97/css/prosion.webflow.a9c5f3f45.min.css" rel="stylesheet" type="text/css" /> 
    <link href="https://assets-global.website-files.com/6356ba441271195b07290d97/63bd7a34fe756f1868815fd4_favicon.png" rel="shortcut icon" type="image/x-icon" />
    <link href="https://assets-global.website-files.com/6356ba441271195b07290d97/63bd7a3b3cd2084c8a00eeb7_webclip.png" rel="apple-touch-icon" />
    <link rel="stylesheet" href="{% static 'assets/custom/style.css'%}">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.usefathom.com/script.js" data-site="ZGHBSMFN" defer></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://3dmol.org/build/3Dmol-min.js"></script>
    <script src="{% static 'assets/custom/script.js'%}"></script>

</head>

<body>
    <div class="page-wrapper">
        <div class="nav">
            <div class="nav-top">
                <div class="page-padding">
                    <div class="nav-top-inner">
                        <a href="/" aria-current="page" class="nav-logo w-inline-block w--current">
                            <div class="logo-img w-embed" style="margin-left: 20px;">
                                <img id="logo-img-light" src="{% static 'assets/logo-light.png' %}" alt="Logo" width="40" height="35" class="light-mode">
                            </div>
                            <div class="logo-text w-embed" style="margin-left: 10px;">
                                <img id="logo-text-light" src="{% static 'assets/text-light.png' %}" alt="Logo Text" width="150" height="20" class="light-mode">
                            </div>
                        </a>
        
                        <a href="/" aria-current="page" class="nav-logo w-inline-block w--current">
                            <div class="logo-img w-embed" style="margin-left: 1100px;">
                                <img id="talan-light" src="{% static 'assets/talan-light.png' %}" alt="Logo" width="75" height="28" class="light-mode">
                            </div>
                        </a>
                        
                    </div>
                </div>
            </div>
        </div>


        <main class="main">

            <div id="popup3" class="popup">
                <span class="close" id="closePopup3">&times;</span>
                <div class="popup-content">
                    <h2>Docking Results</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Model</th>
                                <th>Vina Result (kcal/mol)</th>
                                <th>RMSD LB (Å)</th>
                                <th>RMSD UB (Å)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Model 1</td>
                                <td>-7.5</td>
                                <td>0.000</td>
                                <td>0.000</td>
                            </tr>
                            <tr>
                                <td>Model 2</td>
                                <td>-7.5</td>
                                <td>0.005</td>
                                <td>1.219</td>
                            </tr>
                            <tr>
                                <td>Model 3</td>
                                <td>-7.4</td>
                                <td>2.815</td>
                                <td>5.011</td>
                            </tr>
                            <tr>
                                <td>Model 4</td>
                                <td>-6.8</td>
                                <td>1.285</td>
                                <td>1.893</td>
                            </tr>
                            <tr>
                                <td>Model 5</td>
                                <td>-6.6</td>
                                <td>4.953</td>
                                <td>6.541</td>
                            </tr>
                            <tr>
                                <td>Model 6</td>
                                <td>-6.6</td>
                                <td>5.003</td>
                                <td>7.331</td>
                            </tr>
                            <tr>
                                <td>Model 7</td>
                                <td>-6.6</td>
                                <td>4.334</td>
                                <td>6.280</td>
                            </tr>
                            <tr>
                                <td>Model 8</td>
                                <td>-6.6</td>
                                <td>4.477</td>
                                <td>6.163</td>
                            </tr>
                            <tr>
                                <td>Model 9</td>
                                <td>-6.5</td>
                                <td>5.180</td>
                                <td>7.439</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="best-model"><strong>Best Model:</strong> Model 1 with Vina Result of -7.5 kcal/mol and RMSD LB/UB of 0.000 Å</p>
                </div>
            </div>
        
        
            
            <div id="overlay"></div>
            <div id="popup">
                <span id="popup-close">&times;</span>
                <div id="viewer"></div>
                <button id="popup-close-button">Next</button>
            </div>
            
        
            <div id="overlay2"></div>
            <div id="popup2">
                <span id="popup-close">&times;</span>
                <div class="modal-body">
                    <!-- Dynamic content will be inserted here -->
                    <div id="loading-indicator">Loading, please wait...</div>
                </div>
                <button id="popup-close-button">Next</button>
            </div>


            <div data-w-id="1b5c2f55-bede-fcad-dc58-18de2df76626" class="science-platform-scroll-wrap">
                <div class="sticky-wrap">
                    <section>
                        <div class="page-padding">
                            <div class="container">
                                
                                <div class="blur-left no-pointer-events hidden-on-mobile">
                                    <div class="blur-shape blur-shape--teal"></div>
                                </div>

                                <div class="science-platform-inner">
                                    <div class="science-platform-grid">
                                        <div id="w-node-ad3c992c-7667-0f97-9388-103ae4c52017-a5d808a6" class="science-platform-content">
                                            <div class="platform-heading-wrap">
                                                <!--##########################step1#########################-->
                                                <div class="platform-heading platform-heading--1" style="z-index: -300">   
                                                    <div class="page-padding">
                                                        
                                                        <div class="container">
                                                            <h1>3D Virus Modeling</h1>
                                                            <form id="predictionForm" method="post">
                                                                {% csrf_token %}
                                                                <div class="input1-group">
                                                                    <label for="aminoAcidSequence">Enter your Amino acid sequence</label>
                                                                    <input type="text" id="aminoAcidSequence" name="aminoAcidSequence" placeholder="Your Amino acid sequence">
                                                                    <button type="submit">Generate</button>
                                                                </div>
                                                            </form>
                                                        </div>

                                                    </div>
                                                    
                                                    <div class="spacing-xs"></div>
                                                </div>
                                            </div>
                                                <br></br>
                                                <br></br>
                                                <br></br>
                                                <br></br>
                                            <!--##########################step2#########################-->
                                            <div class="platform-heading platform-heading--2" style="z-index: -500;">
                                                <div class="platform-heading-content">

                                                    <div class="container">
                                                        <h1>Generation of drug ligands</h1>
                                                        <form id="drugLigandFormUnique" method="post">
                                                            {% csrf_token %}
                                                            <div class="input-group">
                                                                <label for="virusNameUnique">Enter your virus name</label>
                                                                <input type="text" id="virusNameUnique" name="virusName" placeholder="Virus Name">
                                                            </div>
                                                            <div class="input-group">
                                                                <label for="virusCharacteristicsUnique">Enter your virus characteristics</label>
                                                                <textarea id="virusCharacteristicsUnique" name="virusCharacteristics" placeholder="Virus Characteristics" rows="4" cols="50"></textarea>
                                                            </div>
                                                            <button class="generate-button-unique" type="submit">Generate SMILES</button>
                                                        </form>
                                                    </div>
                                                    <div class="spacing-xs"></div>
                                                </div>
                                            </div>
                                                
                                            <!--##########################step3#########################-->
                                            <div class="platform-heading platform-heading--3" style="z-index: 0;">
                                                <div class="platform-heading-content">
                                                    <div class="page-padding">
                                                        <div class="container">
                                                            <p class="yosra">Docking</p>
                                                            <p class="h11">Simulates ligand-protein interactions to predict and evaluate binding sites.</p>
                                                        
                                                            <div class="button-container">
                                                                <buttonn class="inline-buttons">Visualize</buttonn>
                                                                <buttonn id="viewDetailsBtn3" class="inline-buttons">View Details</buttonn>
                                                                <buttonn class="inline-buttons">Simulate</buttonn>
                                                            </div>
                                                            
                                                            <div class="visualization"></div>
                                                        </div>

                                                        <div class="spacing-xs"></div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!--##########################step4#########################-->
                                            <div class="platform-heading platform-heading--4" style="z-index: -500;">
                                                <div class="platform-heading-content">
                                                    <h2 class="heading-xl text-gradient-blue cc-platform">Structurally novel drug</h2>
                                                </div>
                                            </div>
                                            
                                       </div>

                                        <div id="w-node-f9433e5e-d2f0-a92d-c3a9-3d4a2b409b36-a5d808a6" class="science-platform-chart-wrap">
                                            <div class="science-platform-chart-rotator"><img src="{% static 'assets\doura\without (1).png'%}" loading="lazy" alt="" /><img src="{% static 'assets\doura\gen (1).png'%}"
                                                    loading="lazy" alt="" class="platform-img platform-img--3" /><img src="{% static 'assets\doura\sim (1).png'%}" loading="lazy" alt=""
                                                    class="platform-img platform-img--2" /><img src="{% static 'assets\doura\mod (1).png'%}" loading="lazy" alt="" class="platform-img platform-img--1"
                                                />
                                            </div>

                                            <div class="platform-icon-wrap"><img src="https://assets-global.website-files.com/6356ba441271195b07290d97/637b904b6de67a3f3aa0996d_Icon%20Final.svg" loading="lazy" alt="" class="platform-icon platform-icon--4" /><img src="https://assets-global.website-files.com/6356ba441271195b07290d97/637b904cf3d6aa7d7d2f4d63_Icon%20Flask.svg"
                                                        loading="lazy" alt="" class="platform-icon platform-icon--3" /><img src="https://assets-global.website-files.com/6356ba441271195b07290d97/637b904ce055f0b691daee8b_Icon%20Optimize.svg" loading="lazy" alt=""
                                                        class="platform-icon platform-icon--2" /><img src="https://assets-global.website-files.com/6356ba441271195b07290d97/637b904b0bce752e22b9a5c5_Icon%20Generate.svg" loading="lazy" alt="" class="platform-icon platform-icon--1"
                                                    />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                </div>
            </div>
        </main>
        <br></br>
        <br></br>
        <br></br>

        <footer class="footer">
            <div class="page-padding">
                <div class="container">
                    <div class="text-size-l">
                        <div class="footer-inner">
                            <div id="w-node-_53ac7952-0c2c-85dd-0d7e-e51c8335eb11-8335eb0c" class="footer-about">
                                <a href="/" aria-current="page" class="footer-logo w-inline-block w--current">
                                    <img src="{% static 'assets/logo.png'%}" alt="Logo" width="170" height="100" class="svg-embed svg-embed--logo-text w-embed" />
                                </a>
                            </div>
                            <div id="w-node-_53ac7952-0c2c-85dd-0d7e-e51c8335eb1f-8335eb0c" class="footer-cell">
                                <h3 class="footer-heading">Company</h3>
                                <a href="/" aria-current="page" class="footer-link w-inline-block w--current">
                                    <div>Home</div>
                                    <div class="footer-link-underline"></div>
                                </a>
                                <a href="/about-us" class="footer-link w-inline-block">
                                    <div>About Us</div>
                                    <div class="footer-link-underline"></div>
                                </a>
                                <a href="/pipeline" class="footer-link w-inline-block">
                                    <div>Pipeline</div>
                                    <div class="footer-link-underline"></div>
                                </a>
                            </div>
                            <div id="w-node-_53ac7952-0c2c-85dd-0d7e-e51c8335eb36-8335eb0c" class="footer-cell">
                                <h3 class="footer-heading">Legal</h3>
                                <a href="/privacy-policy" class="footer-link w-inline-block">
                                    <div>Privacy Policy</div>
                                    <div class="footer-link-underline"></div>
                                </a>
                                <a href="/legal-notice" class="footer-link w-inline-block">
                                    <div>Legal Notice</div>
                                    <div class="footer-link-underline"></div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <br></br>
                    <br></br>
                    <br></br>
                    <br></br>
                
                    <div class="footer-bottom">
                        <div class="footer-boottom-left">
                            <div class="label-small text-color-gray-60">Talan-SummerCamp-24-Team4</div>
                        </div>
                    </div>
                </div>
            </div>
            <img src="https://assets-global.website-files.com/6356ba441271195b07290d97/636238973d47879703d0587c_footer-bg.png" loading="lazy" sizes="100vw" srcset="https://assets-global.website-files.com/6356ba441271195b07290d97/636238973d47879703d0587c_footer-bg-p-500.png 500w, https://assets-global.website-files.com/6356ba441271195b07290d97/636238973d47879703d0587c_footer-bg.png 1440w"
                alt="" class="footer-bg" />
            <div class="footer-bg-blue">
                <div class="blur-shape blur-shape--blue"></div>
            </div>
            <div class="footer-bg-teal">
                <div class="blur-shape blur-shape--teal"></div>
            </div>
            <div class="footer-bg-pink">
                <div class="blur-shape blur-shape--magenta"></div>
            </div>
        
        </footer>
    </div>
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6356ba441271195b07290d97" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://assets-global.website-files.com/6356ba441271195b07290d97/js/webflow.145c7a96b.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/ScrollTrigger.min.js"></script>
        <!-- Script 1-->
    <script>
    $(document).ready(function() {
    $('#predictionForm').on('submit', function(e) {
        e.preventDefault();
        const sequence = $('#aminoAcidSequence').val();
        if (!sequence) {
            alert('The sequence is required.');
            return;
        }

        $.ajax({
            url: '{% url "predict_structure" %}',
            type: 'POST',
            data: {
                aminoAcidSequence: sequence,
                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            success: function(response) {
                console.log('AJAX success', response);  // Log the response data
                if (response.error) {
                    alert('Error: ' + response.error);
                    return;
                }
                
                const pdbContent = response.pdb_content;
                if (pdbContent && pdbContent.startsWith("HEADER")) {  // Basic validation for PDB content
                    $('#overlay').show();
                    $('#popup').show();
                    let viewer = $3Dmol.createViewer("viewer", {defaultcolors: $3Dmol.rasmolElementColors});
                    viewer.addModel(pdbContent, "pdb");
                    viewer.setStyle({}, {cartoon: {color: 'spectrum'}});
                    viewer.zoomTo();
                    viewer.render();
                } else {
                    alert('Invalid PDB content received.');
                    console.error('Invalid PDB content:', pdbContent);
                }
            },
            error: function(xhr, status, error) {
                console.error('AJAX error', xhr, status, error);  // Log the error
                alert('Error predicting the structure.');
            }
        });
    });

    $('#popup-close, #overlay, #popup-close-button').on('click', function() {
        $('#overlay').hide();
        $('#popup').hide();
    });
    });
    </script>
    <!-- Script 2-->
     <script>
        $(document).ready(function () {
    $('#drugLigandFormUnique').on('submit', function (event) {
        event.preventDefault(); // Prevent the default form submission

        // Show the loading indicator
        $('#loading-indicator').show();

        $.ajax({
            url: "{% url 'drug_discovery_view' %}", // Ensure this URL is correct
            type: "POST",
            data: $(this).serialize(),
            success: function (data) {
                // Assuming data.cohere_output contains the raw cohere output text
                var parsedOutput = parseCohereOutput(data.cohere_output);

                $('#popup2 .modal-body').html(`
                    <h1 class="title">Rapport</h1>
                    <h2 class="section-title">structure details</h2>
                    <p><strong>ligand name:</strong> ${parsedOutput.nom_ligand}</p>
                    <p><strong>smiles formula:</strong> ${parsedOutput.formule_smiles}</p>
                    <p><strong>chemical formula:</strong> ${parsedOutput.formule_chimique}</p>
                    <p><strong>molecular weight:</strong> ${parsedOutput.poids_moleculaire}</p>
                    <p><strong>configuration:</strong> ${parsedOutput.configuration}</p>

                    <h2 class="section-title">links affinity</h2>
                    <p><strong>links affinity:</strong> ${parsedOutput.affinite_liaison}</p>
                    <p><strong>links type:</strong> ${parsedOutput.type_liaison}</p>

                    <h2 class="section-title">interaction with targeted protein</h2>
                    <p><strong>links sites:</strong> ${parsedOutput.site_liaison}</p>
                    <p><strong>docking model:</strong> realised with</p>

                    <h2 class="section-title">docking results table</h2>
                    <table class="details-table">
                        <tr>
                            <th>Protéine</th>
                            <th>Score de liaison</th>
                            <th>Score de liaison</th>
                        </tr>
                        <tr>
                            <td>Proteine A</td>
                            <td>9.0</td>
                            <td>Covalente</td>
                        </tr>
                        <tr>
                            <td>Proteine B</td>
                            <td>9.7</td>
                            <td>Ionique</td>
                        </tr>
                    </table>

                    <div id="visualization-container">
                        <h2 class="section-title">view in 3D</h2>
                        <div>${data.html}</div>
                    </div>
                `);

                // Hide the loading indicator
                $('#loading-indicator').hide();

                $('#overlay2').show();
                $('#popup2').show();
            },

            error: function (xhr, status, error) {
                console.error('AJAX error:', xhr.responseText); // Log detailed error message
                $('#popup2 .modal-body').html('<p>Une erreur est survenue. Veuillez réessayer.</p>');
            }
        });
    });

    // Close popup and overlay on click
    $('#popup-close, #overlay2, #popup-close-button').on('click', function () {
        $('#overlay2').hide();
        $('#popup2').hide();
    });

    // Function to parse cohere output using regex patterns
    function parseCohereOutput(cohereOutput) {
        var patterns = {
            'nom_ligand': /Nom du ligand\s*:\s*(.*)/,
            'formule_smiles': /Formule SMILES\s*:\s*(.*)/,
            'formule_chimique': /Formule chimique\s*:\s*(.*)/,
            'poids_moleculaire': /Poids moléculaire\s*:\s*(.*)/,
            'configuration': /Configuration\s*:\s*(.*)/,
            'affinite_liaison': /Affinité de liaison\s*:\s*(.*)/,
            'type_liaison': /Type de liaison\s*:\s*(.*)/,
            'site_liaison': /Site de liaison\s*:\s*(.*)/,
        };

        var parsedOutput = {};
        for (var key in patterns) {
            var match = cohereOutput.match(patterns[key]);
            parsedOutput[key] = match ? match[1] : 'Not found';
        }
        return parsedOutput;
    }
});
     </script>
</body>

</html>